<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è…¦ç­‹æ€¥è½‰å½å¤§è³½ (ç«¶é€Ÿç‰ˆ)</title>
    <style>
        :root {
            --bg-a: #FF8A65; /* Team A Background (Orange/Red) */
            --bg-b: #64B5F6; /* Team B Background (Light Blue) */
            --bg-neutral: #f0f0f0;
            --text-color: #333;
            --card-bg: rgba(255, 255, 255, 0.95);
            --base-font-size: 24px;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--bg-neutral);
            transition: background-color 0.5s ease;
            color: var(--text-color);
        }

        /* éšŠä¼èƒŒæ™¯æ¨£å¼ */
        body.team-a-turn { background-color: var(--bg-a); }
        body.team-b-turn { background-color: var(--bg-b); }

        .container {
            width: 90%;
            max-width: 900px;
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
        }

        h1, h2 { margin-bottom: 1rem; }
        
        /* è¨­å®šé é¢ */
        #setup-screen, #result-screen { display: block; }
        #game-screen { display: none; }

        .btn {
            padding: 15px 30px;
            font-size: 1.2rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-primary { background-color: #4CAF50; color: white; }
        .btn-restart { background-color: #607D8B; color: white; }

        .option-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .option-btn {
            background-color: white;
            border: 2px solid #ddd;
            padding: 20px;
            font-size: var(--base-font-size);
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: left;
        }

        .option-btn:hover { background-color: #f9f9f9; }
        
        /* ç­”å°ç­”éŒ¯ç‰¹æ•ˆ */
        .option-btn.correct { background-color: #81C784 !important; color: white; border-color: #4CAF50; }
        .option-btn.wrong { background-color: #E57373 !important; color: white; border-color: #F44336; }

        .info-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 10px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
        }

        .team-badge {
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
        }
        .badge-a { background-color: #E64A19; }
        .badge-b { background-color: #1976D2; }

        .question-text {
            font-size: calc(var(--base-font-size) * 1.3);
            font-weight: bold;
            margin: 30px 0;
            line-height: 1.4;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* å­—é«”èª¿æ•´æ§åˆ¶ */
        .font-control {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .timer-display {
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            min-width: 120px; /* é˜²æ­¢æ™‚é–“è·³å‹•å°è‡´ç‰ˆé¢æ™ƒå‹• */
        }
        
        /* ç½°æ™‚ç‰¹æ•ˆ */
        .penalty-text {
            color: red;
            font-weight: bold;
            font-size: 1rem;
            animation: blink 0.5s 3;
        }
        
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* çµæœé é¢ */
        .stats-box {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        .stat-card {
            padding: 20px;
            border-radius: 10px;
            width: 40%;
        }
        .stat-a { background-color: #FFCCBC; }
        .stat-b { background-color: #BBDEFB; }
        
        .winner-text {
            font-size: 3rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <audio id="bg-music" loop>
        <source src="mp3.mp3" type="audio/mpeg">
    </audio>

    <div class="container">
        <div id="setup-screen">
            <h1>ğŸ¤ª è…¦ç­‹æ€¥è½‰å½å¤§è³½</h1>
            <h3 style="color: #E57373;">âš ï¸ æ³¨æ„ï¼šç­”éŒ¯å°‡ç½°æ™‚ 7 ç§’ï¼</h3>
            <p>è«‹é¸æ“‡æ¯”è³½é¡Œç›®æ•¸é‡ï¼š</p>
            <div>
                <button class="btn btn-primary" onclick="startGame(10)">10 é¡Œ</button>
                <button class="btn btn-primary" onclick="startGame(20)">20 é¡Œ</button>
                <button class="btn btn-primary" onclick="startGame(40)">40 é¡Œ</button>
            </div>
            <p style="margin-top: 30px; color: #666; font-size: 0.9rem;">
                è¦å‰‡ï¼šAéšŠ(æ©˜)èˆ‡BéšŠ(è—)è¼ªæµä½œç­”ï¼Œ<b>æ¯”è³½å‹è² åƒ…å–æ±ºæ–¼ã€Œç¸½æ™‚é–“ã€</b>(å«ç½°æ™‚)ï¼Œæ™‚é–“çŸ­è€…ç²å‹ï¼
            </p>
        </div>

        <div id="game-screen">
            <div class="font-control">
                å­—é«”å¤§å°: 
                <input type="range" min="16" max="40" value="24" id="fontSizeSlider" oninput="adjustFontSize()">
            </div>

            <div class="info-bar">
                <div class="timer-display" style="color: #E64A19;">AéšŠ: <span id="timerA">00:00</span></div>
                <div>é¡Œè™Ÿ: <span id="q-current">1</span> / <span id="q-total">10</span></div>
                <div class="timer-display" style="color: #1976D2;">BéšŠ: <span id="timerB">00:00</span></div>
            </div>

            <div>
                <span id="current-team-badge" class="team-badge badge-a">ç¾åœ¨è¼ªåˆ°ï¼šA éšŠ</span>
            </div>

            <div class="question-text" id="question-text">
                é¡Œç›®è¼‰å…¥ä¸­...
            </div>

            <div class="option-grid" id="options-container">
                </div>
        </div>

        <div id="result-screen" style="display:none;">
            <h1>æ¯”è³½çµæŸï¼</h1>
            <div id="winner-display" class="winner-text"></div>
            
            <div class="stats-box">
                <div class="stat-card stat-a">
                    <h2>A éšŠ (æ©˜)</h2>
                    <p>å¾—åˆ†: <span id="score-a-final">0</span> (ä¸å½±éŸ¿å‹è² )</p>
                    <p>ç¸½æ™‚é–“: <span id="time-a-final">00:00</span></p>
                </div>
                <div class="stat-card stat-b">
                    <h2>B éšŠ (è—)</h2>
                    <p>å¾—åˆ†: <span id="score-b-final">0</span> (ä¸å½±éŸ¿å‹è² )</p>
                    <p>ç¸½æ™‚é–“: <span id="time-b-final">00:00</span></p>
                </div>
            </div>
            
            <button class="btn btn-restart" onclick="location.reload()">é‡æ–°é–‹å§‹</button>
        </div>
    </div>

<script>
    // === ä¿®æ”¹é» 3: é¡Œåº«è³‡æ–™æ›´æ›ç‚º jokeQ.txt çš„å…§å®¹ (å·²æ•´ç†æ ¼å¼) ===
    // ç‚ºäº†ç¢ºä¿ç¨‹å¼èƒ½æ­£ç¢ºè®€å–ï¼Œå·²å°‡åŸå§‹é›œäº‚çš„æ–‡æœ¬çµ±ä¸€æ¨™æº–åŒ–ç‚ºï¼š é¡Œç›® (A) (B) (C) (D) ç­”æ¡ˆï¼š(X)
    const rawData = `
ä»€éº¼æ±è¥¿è¶Šæ´—è¶Šé«’ï¼Ÿ (A) è¡£æœ (B) è‚¥çš‚ (C) æ°´ (D) æ‰‹ ç­”æ¡ˆï¼š(C)
ä»€éº¼é–€æ°¸é æ‰“ä¸é–‹ï¼Ÿ (A) å®¶é–€ (B) è»Šé–€ (C) çƒé–€ (D) éµé–€ ç­”æ¡ˆï¼š(C)
ä»€éº¼å¸ƒå‰ªä¸æ–·ï¼Ÿ (A) æ£‰å¸ƒ (B) çµ²å¸ƒ (C) ç€‘å¸ƒ (D) é›²å¸ƒ ç­”æ¡ˆï¼š(C)
ä»€éº¼ç«¹å­ä¸é•·åœ¨åœŸè£¡ï¼Ÿ (A) æ¯›ç«¹ (B) ç®­ç«¹ (C) çˆ†ç«¹ (D) ç´«ç«¹ ç­”æ¡ˆï¼š(C)
ä»€éº¼ç‰›ä¸åƒè‰ï¼Ÿ (A) å¥¶ç‰› (B) å…¬ç‰› (C) èœ—ç‰› (D) é»ƒç‰› ç­”æ¡ˆï¼š(C)
ä»€éº¼æ°´æ°¸é æ‹¿ä¸å‹•ï¼Ÿ (A) æµ·æ°´ (B) æ²³æ°´ (C) å£æ°´ (D) é›¨æ°´ ç­”æ¡ˆï¼š(C)
æ‰“ä»€éº¼æ±è¥¿ä¸ç”¨è²»åŠ›æ°£ï¼Ÿ (A) é¼“ (B) ç±ƒçƒ (C) é›»è©± (D) é‡ ç­”æ¡ˆï¼š(C)
ç‚ºä»€éº¼é’è›™èƒ½è·³å¾—æ¯”æ¨¹é«˜ï¼Ÿ (A) é’è›™è…¿é•· (B) é’è›™åŠ›æ°£å¤§ (C) æ¨¹å¤ªçŸ® (D) æ¨¹ä¸æœƒè·³ ç­”æ¡ˆï¼š(D)
ä»€éº¼è€é¼ ç”¨å…©éš»è…³èµ°è·¯ï¼Ÿ (A) æ™®é€šè€é¼  (B) æ¾é¼  (C) ç±³è€é¼  (D) é›»è…¦é¼  ç­”æ¡ˆï¼š(C)
ä»€éº¼é´¨å­ç”¨å…©éš»è…³èµ°è·¯ï¼Ÿ (A) å”è€é´¨ (B) åŒ—äº¬é´¨ (C) æ‰€æœ‰é´¨å­ (D) ç©å…·é´¨å­ ç­”æ¡ˆï¼š(C)
ä»€éº¼æ±è¥¿æœ‰çœ¼ç›å»çœ‹ä¸è¦‹ï¼Ÿ (A) é‡ (B) é¦¬éˆ´è–¯ (C) é¢±é¢¨ (D) ä»¥ä¸Šçš†æ˜¯ ç­”æ¡ˆï¼š(D)
å°åŒ—åˆ°é«˜é›„æœ‰å¤šé ï¼Ÿ (A) ç´„400å…¬é‡Œ (B) ä¸€å¼µé«˜éµç¥¨é‚£éº¼é  (C) å¾ˆè¿‘ (D) ä¸çŸ¥é“ ç­”æ¡ˆï¼š(B)
ä»€éº¼èŠ±ä¸èƒ½æ‘˜ï¼Ÿ (A) ç«ç‘° (B) æ«»èŠ± (C) ç«èŠ± (D) å‘æ—¥è‘µ ç­”æ¡ˆï¼š(C)
ä»€éº¼è›‹ä¸èƒ½åƒï¼Ÿ (A) é›è›‹ (B) é´¨è›‹ (C) å£è›‹ (D) çš®è›‹ ç­”æ¡ˆï¼š(C)
ä»€éº¼å±±æ²’æœ‰çŸ³é ­ï¼Ÿ (A) æ³°å±± (B) è¯å±± (C) å†°å±± (D) ç«ç„°å±± ç­”æ¡ˆï¼š(C)
ä»€éº¼æµ·æ²’æœ‰é­šï¼Ÿ (A) ç´…æµ· (B) é»‘æµ· (C) æ­»æµ· (D) åœ°ä¸­æµ· ç­”æ¡ˆï¼š(C)
ä»€éº¼æ±è¥¿ç ´äº†æ‰å¥½ï¼Ÿ (A) ç»ç’ƒæ¯ (B) å¿ƒ (C) è¨˜éŒ„ (D) æ‰‹æ©Ÿ ç­”æ¡ˆï¼š(C)
ä»€éº¼æ±è¥¿è²·ä¾†æ˜¯é»‘çš„ï¼Œç”¨æ™‚æ˜¯ç´…çš„ï¼Œç”¨å¾Œæ˜¯ç°çš„ï¼Ÿ (A) è Ÿç‡­ (B) æœ¨ç‚­ (C) ç«æŸ´ (D) ç…¤ ç­”æ¡ˆï¼š(B)
ç‚ºä»€éº¼æœ‰äº›è»Šå­å‰é¢æœ‰ã€Œå­¸ã€å­—ï¼Ÿ (A) å­¸ç”Ÿé–‹çš„ (B) å­¸è»Š (C) æ–°è»Š (D) å­¸æ ¡çš„ ç­”æ¡ˆï¼š(B)
ä»€éº¼å‹•ç‰©æœ€æœƒéš±è—è‡ªå·±ï¼Ÿ (A) è€è™ (B) ç‹ç‹¸ (C) è®Šè‰²é¾ (D) è²“ ç­”æ¡ˆï¼š(C)
è«‹å•ã€Œç¶ è±†ã€æ˜¯å“ªè£¡äººï¼Ÿ (A) å°åŒ—äºº (B) å°å—äºº (C) å˜‰ç¾©äºº (D) å½°åŒ–äºº ç­”æ¡ˆï¼š(C)
æ•¸å­— 1 åˆ° 9ï¼Œèª°æœ€æ‡¶æƒ°ï¼Ÿ (A) 1 (B) 7 (C) 9 (D) 2 ç­”æ¡ˆï¼š(A)
æ•¸å­— 0 åˆ° 9ï¼Œèª°æœ€å‹¤å‹ï¼Ÿ (A) 2 (B) 4 (C) 3 (D) 1 ç­”æ¡ˆï¼š(A)
å“ªä½å¤äººè·‘å¾—æœ€å¿«ï¼Ÿ (A) é—œç¾½ (B) æ›¹æ“ (C) åŠ‰å‚™ (D) å­«æ‚Ÿç©º ç­”æ¡ˆï¼š(B)
ä»€éº¼å‹•ç‰©æœ€å®¹æ˜“è¢«è²¼åœ¨ç‰†å£ä¸Šï¼Ÿ (A) å£è™ (B) æµ·è±¹ (C) ç…å­ (D) æ–‘é¦¬ ç­”æ¡ˆï¼š(B)
çŒ´å­æœ€è¨å­ä»€éº¼ç·šï¼Ÿ (A) æ–‘é¦¬ç·š (B) åœæ­¢ç·š (C) å¹³è¡Œç·š (D) æ‹‹ç‰©ç·š ç­”æ¡ˆï¼š(C)
å“ªä¸€ç¨®ç‹—æœ€ç†±ï¼Ÿ (A) è‡˜è…¸ç‹— (B) ç†±ç‹— (C) å“ˆå£«å¥‡ (D) è²´è³“ç‹— ç­”æ¡ˆï¼š(B)
ä»€éº¼æ°´æœæœ€ç‡™ï¼Ÿ (A) è¥¿ç“œ (B) è˜‹æœ (C) æ¢¨å­ (D) é¦™è•‰ ç­”æ¡ˆï¼š(C)
æœ‰ä¸€éš»ç‹¼æ‰é€²å—æ¥µçš„å†°æµ·è£¡ï¼Œè®Šæˆä»€éº¼ï¼Ÿ (A) å†°ç‹¼ (B) æª³æ¦” (C) é›ªç‹¼ (D) è½æ°´ç‹— ç­”æ¡ˆï¼š(B)
å“ªä¸€ç¨®èŠ±æœ€æ²’åŠ›æ°£ï¼Ÿ (A) ç«ç‘°èŠ± (B) èŒ‰è‰èŠ± (C) å¤ªé™½èŠ± (D) ç‰½ç‰›èŠ± ç­”æ¡ˆï¼š(B)
é€æ˜äººä¾†äº†ï¼Œä½ æƒ³å°ä»–èªªä»€éº¼ï¼Ÿ (A) ä½ å¥½ (B) å€Ÿé (C) å¥½ä¹…ä¸è¦‹ (D) é¬¼å•Š ç­”æ¡ˆï¼š(C)
ä»€éº¼æ¨£çš„è·¯ä¸èƒ½èµ°ï¼Ÿ (A) é«˜é€Ÿå…¬è·¯ (B) é¦¬è·¯ (C) éµè·¯ (D) é›»è·¯ ç­”æ¡ˆï¼š(D)
ä»€éº¼å¸ƒå‰ªä¸æ–·ï¼Ÿ (A) æ£‰å¸ƒ (B) éº»å¸ƒ (C) ç€‘å¸ƒ (D) ç•«å¸ƒ ç­”æ¡ˆï¼š(C)
ä»€éº¼è€é¼ ç”¨å…©éš»è…³èµ°è·¯ï¼Ÿ (A) è¢‹é¼  (B) ç±³è€é¼  (C) å€‰é¼  (D) æ¾é¼  ç­”æ¡ˆï¼š(B)
ä»€éº¼é´¨å­ç”¨å…©éš»è…³èµ°è·¯ï¼Ÿ (A) å”è€é´¨ (B) è–‘æ¯é´¨ (C) æ‰€æœ‰çš„é´¨å­ (D) åŒ—äº¬çƒ¤é´¨ ç­”æ¡ˆï¼š(C)
å“ªä¸€å€‹å­—æ°¸é å¯«éŒ¯ï¼Ÿ (A) é›£ (B) ç¹ (C) éŒ¯ (D) äº‚ ç­”æ¡ˆï¼š(C)
éº’éºŸé£›åˆ°åŒ—æ¥µæœƒè®Šæˆä»€éº¼ï¼Ÿ (A) å†°éº’éºŸ (B) è–ç¸ (C) å†°é›• (D) å†·å‡è‚‰ ç­”æ¡ˆï¼š(A)
ä»€éº¼æ±è¥¿è¶Šæ´—è¶Šé«’ï¼Ÿ (A) æ°´ (B) æ¯›å·¾ (C) è‚¥çš‚ (D) é‹å­ ç­”æ¡ˆï¼š(B)
ä»€éº¼è»Šæœ€ä¸æ€•å¡è»Šï¼Ÿ (A) å…¬è»Š (B) è¨ˆç¨‹è»Š (C) ç«è»Š (D) è³¼ç‰©è»Š ç­”æ¡ˆï¼š(D)
ä»€éº¼æ±è¥¿æœ‰é ­æ²’æœ‰èº«é«”ï¼Ÿ (A) é‰›ç­† (B) ç¡¬å¹£ (C) é‡ (D) é­š ç­”æ¡ˆï¼š(C)
ä»€éº¼é–€æ°¸é é—œä¸ä¸Šï¼Ÿ (A) å®¶é–€ (B) è»Šé–€ (C) çƒé–€ (D) å¿ƒé–€ ç­”æ¡ˆï¼š(C)
å“ªä¸€å€‹æœˆæœ€å®¹æ˜“æ„Ÿå†’ï¼Ÿ (A) ä¸€æœˆ (B) äºŒæœˆ (C) ä¸‰æœˆ (D) åäºŒæœˆ ç­”æ¡ˆï¼š(B)
ç‚ºä»€éº¼æ›¸æœ¬æœ€æ€•ä¸‹é›¨ï¼Ÿ (A) æœƒæ·‹æ¿• (B) æœƒè®Šé‡ (C) æœƒç™¼éœ‰ (D) æœƒè®Šæˆæ°´æ›¸ ç­”æ¡ˆï¼š(D)
ä»€éº¼äººæœ€ä¸æ€•å†·ï¼Ÿ (A) åŒ—æ¥µäºº (B) é›ªäºº (C) å†·æ°£å¸«å‚… (D) å†°ç®± ç­”æ¡ˆï¼š(B)
ä»€éº¼æ±è¥¿è¶Šåˆ†äº«è¶Šå°‘ï¼Ÿ (A) å¿«æ¨‚ (B) è›‹ç³• (C) çŸ¥è­˜ (D) æ„› ç­”æ¡ˆï¼š(B)
ç‚ºä»€éº¼é›»è…¦å¸¸å¸¸ç”Ÿæ°£ï¼Ÿ (A) å¤ªç†± (B) ä¸­æ¯’ (C) ç•¶æ©Ÿ (D) æ²’é›» ç­”æ¡ˆï¼š(C)
ä»€éº¼æ±è¥¿æœ‰è…³å»èµ°ä¸å‹•ï¼Ÿ (A) æ¡Œå­ (B) ç‹— (C) é‹å­ (D) äºº ç­”æ¡ˆï¼š(A)
ä»€éº¼å‹•ç‰©æœ€æœƒæ‰“é›»è©±ï¼Ÿ (A) çŒ´å­ (B) è€è™ (C) é•·é ¸é¹¿ (D) è¸ç‰› ç­”æ¡ˆï¼š(A)
ä»€éº¼æ±è¥¿æ¯å¤©éƒ½æœƒé•·å¤§ä¸€æ¬¡ï¼Ÿ (A) æ¨¹ (B) é¦¬æ¡¶ (C) å¹´ç´€ (D) é«”é‡ ç­”æ¡ˆï¼š(C)
ç‚ºä»€éº¼æµ·è£¡çš„æ°´ä¸æœƒæµèµ°ï¼Ÿ (A) å¤ªå¤š (B) å¤ªæ·± (C) æ²’å‡ºå£ (D) æœ‰é˜²æ³¢å ¤ ç­”æ¡ˆï¼š(C)
ä»€éº¼ç“œä¸èƒ½åƒï¼Ÿ (A) è¥¿ç“œ (B) å†¬ç“œ (C) å—ç“œ (D) å‚»ç“œ ç­”æ¡ˆï¼š(D)
ä»€éº¼æ±è¥¿æœ‰çœ¼ç›å»çœ‹ä¸åˆ°ï¼Ÿ (A) é‡ (B) é¢¨ (C) é­š (D) è€é·¹ ç­”æ¡ˆï¼š(A)
ç‚ºä»€éº¼è¶…äººä¸Šç­é²åˆ°ï¼Ÿ (A) ç¡éé ­ (B) è»Šå£äº† (C) å»æ•‘äºº (D) é£›å¤ªæ…¢ ç­”æ¡ˆï¼š(C)
ä»€éº¼æ±è¥¿è¶Šç”¨è¶Šå°ï¼Ÿ (A) é‰›ç­† (B) æ‰‹æ©Ÿ (C) æ›¸ (D) é›»è…¦ ç­”æ¡ˆï¼š(A)
ç‚ºä»€éº¼é­šä¸èªªè©±ï¼Ÿ (A) ä¸æœƒèªª (B) æ²’äººè½ (C) åœ¨æ°´è£¡ (D) æ€•è¢«ç…® ç­”æ¡ˆï¼š(C)
    `;

    // === éŠæˆ²è®Šæ•¸ ===
    let questions = [];
    let currentQuestions = [];
    let currentQIndex = 0;
    let turn = 'A'; // 'A' or 'B'
    let scoreA = 0;
    let scoreB = 0;
    let timeA = 0; // ms
    let timeB = 0; // ms
    let timerInterval = null;
    let lastTime = 0;
    
    // å–å¾—éŸ³æ•ˆå…ƒç´ 
    const bgMusic = document.getElementById('bg-music');

    // === è§£æè³‡æ–™ (Regex å·²æ›´æ–°ä»¥åŒ¹é…æ–°æ ¼å¼) ===
    function parseData() {
        const lines = rawData.split('\n').filter(line => line.trim() !== '');
        const parsed = [];
        
        // æ­£è¦è¡¨é”å¼èªªæ˜ï¼š
        // åŒ¹é… é¡Œç›®... (A) ... (B) ... (C) ... (D) ... ç­”æ¡ˆï¼š(X)
        const regex = /(.+?)\s*\(A\)\s*(.+?)\s*\(B\)\s*(.+?)\s*\(C\)\s*(.+?)\s*\(D\)\s*(.+?)\s*ç­”æ¡ˆï¼š\(([A-D])\)/;
        
        lines.forEach(line => {
            const match = line.match(regex);
            if (match) {
                parsed.push({
                    q: match[1].trim(),
                    options: {
                        A: match[2].trim(),
                        B: match[3].trim(),
                        C: match[4].trim(),
                        D: match[5].trim()
                    },
                    ans: match[6]
                });
            }
        });
        return parsed;
    }

    // === åˆå§‹åŒ–éŠæˆ² ===
    function startGame(count) {
        questions = parseData();
        if (questions.length === 0) {
            alert("é¡Œåº«è§£æå¤±æ•—ï¼Œè«‹æª¢æŸ¥è³‡æ–™æ ¼å¼ã€‚");
            return;
        }

        // éš¨æ©Ÿæ´—ç‰Œ
        questions.sort(() => 0.5 - Math.random());
        // å–å‡ºå‰ N é¡Œ
        const actualCount = Math.min(count, questions.length);
        currentQuestions = questions.slice(0, actualCount);
        
        // é‡ç½®è®Šæ•¸
        currentQIndex = 0;
        turn = 'A';
        scoreA = 0;
        scoreB = 0;
        timeA = 0;
        timeB = 0;
        document.getElementById('timerA').innerText = "00:00.00";
        document.getElementById('timerB').innerText = "00:00.00";
        document.getElementById('q-total').innerText = currentQuestions.length;
        
        // åˆ‡æ›ç•«é¢
        document.getElementById('setup-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'block';

        // æ’­æ”¾éŸ³æ¨‚
        bgMusic.currentTime = 0;
        bgMusic.play().catch(e => console.log("Autoplay blocked:", e));

        updateTeamUI();
        loadQuestion();
        startTimer();
    }

    // === è¼‰å…¥é¡Œç›® ===
    function loadQuestion() {
        if (currentQIndex >= currentQuestions.length) {
            endGame();
            return;
        }

        const qData = currentQuestions[currentQIndex];
        document.getElementById('q-current').innerText = currentQIndex + 1;
        document.getElementById('question-text').innerText = qData.q;
        
        const container = document.getElementById('options-container');
        container.innerHTML = ''; // æ¸…ç©ºé¸é …

        ['A', 'B', 'C', 'D'].forEach(optKey => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = `(${optKey}) ${qData.options[optKey]}`;
            btn.onclick = () => checkAnswer(optKey, qData.ans, btn);
            container.appendChild(btn);
        });
    }

    // === æª¢æŸ¥ç­”æ¡ˆ (ç½°æ™‚ 7 ç§’) ===
    function checkAnswer(selected, correct, btnElement) {
        stopTimer(); // æš«åœè¨ˆæ™‚ï¼Œé¡¯ç¤ºçµæœ
        
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.style.pointerEvents = 'none');

        if (selected === correct) {
            btnElement.classList.add('correct');
            if (turn === 'A') scoreA++; else scoreB++;
        } else {
            // ç­”éŒ¯é‚è¼¯
            btnElement.classList.add('wrong');
            
            // 1. æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆ
            allBtns.forEach(b => {
                if (b.innerText.startsWith(`(${correct})`)) {
                    b.classList.add('correct');
                }
            });

            // 2. å¢åŠ æ™‚é–“ (ç½°æ™‚ 7 ç§’)
            const penalty = 7000; 
            if (turn === 'A') {
                timeA += penalty;
                const timerEl = document.getElementById('timerA');
                timerEl.innerText = formatTime(timeA) + " (+7ç§’)";
                timerEl.classList.add('penalty-text');
                setTimeout(() => timerEl.classList.remove('penalty-text'), 1000);
            } else {
                timeB += penalty;
                const timerEl = document.getElementById('timerB');
                timerEl.innerText = formatTime(timeB) + " (+7ç§’)";
                timerEl.classList.add('penalty-text');
                setTimeout(() => timerEl.classList.remove('penalty-text'), 1000);
            }
        }

        // å»¶é²å¾Œæ›ä¸‹ä¸€é¡Œ
        setTimeout(() => {
            currentQIndex++;
            switchTurn();
            loadQuestion();
            startTimer();
        }, 1500);
    }

    // === åˆ‡æ›éšŠä¼ ===
    function switchTurn() {
        turn = turn === 'A' ? 'B' : 'A';
        updateTeamUI();
    }

    // === æ›´æ–° UI ===
    function updateTeamUI() {
        const body = document.body;
        const badge = document.getElementById('current-team-badge');
        
        body.classList.remove('team-a-turn', 'team-b-turn');
        badge.classList.remove('badge-a', 'badge-b');

        if (turn === 'A') {
            body.classList.add('team-a-turn');
            badge.classList.add('badge-a');
            badge.innerText = "ç¾åœ¨è¼ªåˆ°ï¼šA éšŠ (æ©˜)";
        } else {
            body.classList.add('team-b-turn');
            badge.classList.add('badge-b');
            badge.innerText = "ç¾åœ¨è¼ªåˆ°ï¼šB éšŠ (è—)";
        }
    }

    // === è¨ˆæ™‚å™¨é‚è¼¯ ===
    function startTimer() {
        lastTime = Date.now();
        timerInterval = setInterval(() => {
            const now = Date.now();
            const diff = now - lastTime;
            lastTime = now;

            if (turn === 'A') {
                timeA += diff;
                document.getElementById('timerA').innerText = formatTime(timeA);
            } else {
                timeB += diff;
                document.getElementById('timerB').innerText = formatTime(timeB);
            }
        }, 50);
    }

    function stopTimer() {
        clearInterval(timerInterval);
    }

    function formatTime(ms) {
        const totalSeconds = Math.floor(ms / 1000);
        const minutes = Math.floor(totalSeconds / 60).toString().padStart(2, '0');
        const seconds = (totalSeconds % 60).toString().padStart(2, '0');
        const millis = Math.floor((ms % 1000) / 10).toString().padStart(2, '0');
        return `${minutes}:${seconds}.${millis}`;
    }

    // === éŠæˆ²çµæŸ ===
    function endGame() {
        stopTimer();
        
        // æš«åœéŸ³æ¨‚
        bgMusic.pause();

        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        
        document.body.classList.remove('team-a-turn', 'team-b-turn'); 

        document.getElementById('score-a-final').innerText = scoreA;
        document.getElementById('time-a-final').innerText = formatTime(timeA);
        document.getElementById('score-b-final').innerText = scoreB;
        document.getElementById('time-b-final').innerText = formatTime(timeB);

        // åˆ¤æ–·å‹è²  (ç´”ç²¹æ¯”æ™‚é–“)
        let winnerText = "";
        
        if (timeA < timeB) {
            winnerText = "ğŸ‰ A éšŠç²å‹ï¼(æ™‚é–“è¼ƒçŸ­)";
        } else if (timeB < timeA) {
            winnerText = "ğŸ‰ B éšŠç²å‹ï¼(æ™‚é–“è¼ƒçŸ­)";
        } else {
            winnerText = "ğŸ¤ å¹³æ‰‹ï¼";
        }

        document.getElementById('winner-display').innerText = winnerText;
    }

    function adjustFontSize() {
        const val = document.getElementById('fontSizeSlider').value;
        document.documentElement.style.setProperty('--base-font-size', val + 'px');
    }
</script>

</body>
</html>